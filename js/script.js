//Hearts
let cardAceHearts = [11, "Ace", "Hearts", "images/cards/hearts/hearts_A.png"];
let cardTwoHearts = [2, "Two", "Hearts", "images/cards/hearts/hearts_2.png"];
let cardThreeHearts = [3, "Three", "Hearts", "images/cards/hearts/hearts_3.png"];
let cardFourHearts = [4, "Four", "Hearts", "images/cards/hearts/hearts_4.png"];
let cardFiveHearts = [5, "Five", "Hearts", "images/cards/hearts/hearts_5.png"];
let cardSixHearts = [6, "Six", "Hearts", "images/cards/hearts/hearts_6.png"];
let cardSevenHearts = [7, "Seven", "Hearts", "images/cards/hearts/hearts_7.png"];
let cardEightHearts = [8, "Eight", "Hearts", "images/cards/hearts/hearts_8.png"];
let cardNineHearts = [9, "Nine", "Hearts", "images/cards/hearts/hearts_9.png"];
let cardTenHearts = [10, "Ten", "Hearts", "images/cards/hearts/hearts_10.png"];
let cardJackHearts = [10, "Jack", "Hearts", "images/cards/hearts/hearts_J.png"];
let cardQueenHearts = [10, "Queen", "Hearts", "images/cards/hearts/hearts_Q.png"];
let cardKingHearts = [10, "King", "Hearts", "images/cards/hearts/hearts_K.png"];
//Diamonds
let cardAceDiamonds = [11, "Ace", "Diamonds", 'images/cards/diamonds/diamonds_A.png'];
let cardTwoDiamonds = [2, "Two", "Diamonds", 'images/cards/diamonds/diamonds_2.png'];
let cardThreeDiamonds = [3, "Three", "Diamonds", 'images/cards/diamonds/diamonds_3.png'];
let cardFourDiamonds = [4, "Four", "Diamonds", 'images/cards/diamonds/diamonds_4.png'];
let cardFiveDiamonds = [5, "Five", "Diamonds", 'images/cards/diamonds/diamonds_5.png'];
let cardSixDiamonds = [6, "Six", "Diamonds", 'images/cards/diamonds/diamonds_6.png'];
let cardSevenDiamonds = [7, "Seven", "Diamonds", 'images/cards/diamonds/diamonds_7.png'];
let cardEightDiamonds = [8, "Eight", "Diamonds", 'images/cards/diamonds/diamonds_8.png'];
let cardNineDiamonds = [9, "Nine", "Diamonds", 'images/cards/diamonds/diamonds_9.png'];
let cardTenDiamonds = [10, "Ten", "Diamonds", 'images/cards/diamonds/diamonds_10.png'];
let cardJackDiamonds = [10, "Jack", "Diamonds", 'images/cards/diamonds/diamonds_J.png'];
let cardQueenDiamonds = [10, "Queen", "Diamonds", 'images/cards/diamonds/diamonds_Q.png'];
let cardKingDiamonds = [10, "King", "Diamonds", 'images/cards/diamonds/diamonds_K.png'];
//Clubs
let cardAceClubs = [11, "Ace", "Clubs", 'images/cards/clubs/clubs_A.png'];
let cardTwoClubs = [2, "Two", "Clubs", 'images/cards/clubs/clubs_2.png'];
let cardThreeClubs = [3, "Three", "Clubs", 'images/cards/clubs/clubs_3.png'];
let cardFourClubs = [4, "Four", "Clubs", 'images/cards/clubs/clubs_4.png'];
let cardFiveClubs = [5, "Five", "Clubs", 'images/cards/clubs/clubs_5.png'];
let cardSixClubs = [6, "Six", "Clubs", 'images/cards/clubs/clubs_6.png'];
let cardSevenClubs = [7, "Seven", "Clubs", 'images/cards/clubs/clubs_7.png'];
let cardEightClubs = [8, "Eight", "Clubs", 'images/cards/clubs/clubs_8.png'];
let cardNineClubs = [9, "Nine", "Clubs", 'images/cards/clubs/clubs_9.png'];
let cardTenClubs = [10, "Ten", "Clubs", 'images/cards/clubs/clubs_10.png'];
let cardJackClubs = [10, "Jack", "Clubs", 'images/cards/clubs/clubs_J.png'];
let cardQueenClubs = [10, "Queen", "Clubs", 'images/cards/clubs/clubs_Q.png'];
let cardKingClubs = [10, "King", "Clubs", 'images/cards/clubs/clubs_K.png'];
//Spades
let cardAceSpades = [11, "Ace", "Spades", 'images/cards/spades/spades_A.png'];
let cardTwoSpades = [2, "Two", "Spades", 'images/cards/spades/spades_2.png'];
let cardThreeSpades = [3, "Three", "Spades", 'images/cards/spades/spades_3.png'];
let cardFourSpades = [4, "Four", "Spades", 'images/cards/spades/spades_4.png'];
let cardFiveSpades = [5, "Five", "Spades", 'images/cards/spades/spades_5.png'];
let cardSixSpades = [6, "Six", "Spades", 'images/cards/spades/spades_6.png'];
let cardSevenSpades = [7, "Seven", "Spades", 'images/cards/spades/spades_7.png'];
let cardEightSpades = [8, "Eight", "Spades", 'images/cards/spades/spades_8.png'];
let cardNineSpades = [9, "Nine", "Spades", 'images/cards/spades/spades_9.png'];
let cardTenSpades = [10, "Ten", "Spades", 'images/cards/spades/spades_10.png'];
let cardJackSpades = [10, "Jack", "Spades", 'images/cards/spades/spades_J.png'];
let cardQueenSpades = [10, "Queen", "Spades", 'images/cards/spades/spades_Q.png'];
let cardKingSpades = [10, "King", "Spades", 'images/cards/spades/spades_K.png'];

let allCards = [
    //Hearts
    cardAceHearts, cardTwoHearts, cardThreeHearts, cardFourHearts, cardFiveHearts, cardSixHearts, cardSevenHearts,
    cardEightHearts, cardNineHearts, cardTenHearts, cardJackHearts, cardQueenHearts, cardKingHearts,
    //Diamonds
    cardAceDiamonds, cardTwoDiamonds, cardThreeDiamonds, cardFourDiamonds, cardFiveDiamonds, cardSixDiamonds, cardSevenDiamonds,
    cardEightDiamonds, cardNineDiamonds, cardTenDiamonds, cardJackDiamonds, cardQueenDiamonds, cardKingDiamonds,
    //Clubs
    cardAceClubs, cardTwoClubs, cardThreeClubs, cardFourClubs, cardFiveClubs, cardSixClubs, cardSevenClubs,
    cardEightClubs, cardNineClubs, cardTenClubs, cardJackClubs, cardQueenClubs, cardKingClubs,
    //Spades
    cardAceSpades, cardTwoSpades, cardThreeSpades, cardFourSpades, cardFiveSpades, cardSixSpades, cardSevenSpades,
    cardEightSpades, cardNineSpades, cardTenSpades, cardJackSpades, cardQueenSpades, cardKingSpades
];
let playerCount = 0;
let dealerCount = 0
let playerAceCount = 0;
let dealerAceCount = 0;
let betMoney = 0
let dealerOutput = document.querySelector('.dealerCount');
let playerOutput = document.querySelector('.playerCount');
let cardOutputDealer = document.querySelector('.cardDisplayDealer')
let cardOutputPlayer = document.querySelector('.cardDisplayPlayer')
let startButton = document.querySelector('#playButton');
let hitButton = document.querySelector('#hitButton');
let standButton = document.querySelector('#standButton');
let playerOutcome = document.querySelector('.playerOutcome');
let dealerOutcome = document.querySelector('.dealerOutcome');
let imageResetDealer = document.querySelector('.cardDisplayImageDealer');
let imageResetPlayer = document.querySelector('.cardDisplayImagePlayer');
let chipDisplaySection = document.querySelector('#chipDisplay');
let betValue = document.querySelector('.bet')
let bankrollSelector = document.querySelector(".bankrollAmount");
let allInButton = document.querySelector("#allInButton");
let resetBank = document.querySelector('.reset');
let dealerScore = document.querySelector('.dealerScore');
let playerScore = document.querySelector('.playerScore')
let bankroll = 0
let playerName = document.querySelector('.playerName')
let playerNameSecond = document.querySelector('.playerPlayer')

checkForName();
hideButtons();
addBankrollStorage();
addScoreToStorage();


function startGame() {
    playerStartCards();
    dealerStartCards();
    checkForTie();
    allInButton.style.display = "none";
    startButton.style.display = "none";
    hitButton.style.display = 'inline-block';
    standButton.style.display = 'inline-block';
    resetBank.style.display = 'none';
    chipDisplaySection.style.display = 'none';
    
    betValue.innerHTML = `Bet: ${Number(chipValueBetNumber.innerHTML)}`;
    bankroll -= Number(chipValueBetNumber.innerHTML);
    bankrollSelector.innerHTML = bankroll;
    localStorage.setItem('bankroll', bankroll);
    
}
function playerStartCards(){
    const getRandomCard = selectRandomWithoutRepetition(allCards);
    let randomCard = getRandomCard()
   
    let getRandomCardTwo = selectRandomWithoutRepetition(allCards);
    let randomCardTwo = getRandomCardTwo()
   
   
    
    playerCount += randomCard[0];
    playerCount += randomCardTwo[0];
    playerOutput.innerHTML = playerCount;
    
    playerCount = checkForAce(playerCount, randomCard[1]);
    playerCount = checkForAce(playerCount, randomCardTwo[1]);
    playerOutput.innerHTML = playerCount;
    cardOutputPlayer.innerHTML = `${randomCard[1]} of ${randomCard[2]}` + `, ${randomCardTwo[1]} of ${randomCardTwo[2]}`;
    
    let cardImage = new Image();
    cardImage.src = randomCard[3]
    document.querySelector('.cardDisplayImagePlayer').appendChild(cardImage);
    
    
    let cardImageTwo = new Image()
    cardImageTwo.src = randomCardTwo[3]
    document.querySelector('.cardDisplayImagePlayer').appendChild(cardImageTwo);

    if(playerCount === 21){
        playerOutCome();
        endGame();
        modalBlackjackWin();
            betAmount = betValue.innerHTML = `Bet: ${Number(chipValueBetNumber.innerHTML) * 2}`;
            bankroll += Number(chipValueBetNumber.innerHTML) * 2;
            bankrollSelector.innerHTML = bankroll
            localStorage.setItem('bankroll', bankroll);
            playerScore.innerHTML = Number(playerScore.innerHTML) + 1;
            localStorage.setItem('playerScore', playerScore.innerHTML) 
    }
}
function dealerStartCards(){
    const getRandomCard = selectRandomWithoutRepetition(allCards);
    let randomCard = getRandomCard()
    

    let getRandomCardTwo = selectRandomWithoutRepetition(allCards);
    let randomCardTwo = getRandomCardTwo()

    
    dealerCount += randomCard[0];
    dealerCount += randomCardTwo[0];
    dealerOutput.innerHTML = dealerCount;

    dealerCount = checkForAce(dealerCount, randomCard[1]);
    dealerCount = checkForAce(dealerCount, randomCardTwo[1]);
    dealerOutput.innerHTML = dealerCount;

    cardOutputDealer.innerHTML = `${randomCard[1]} of ${randomCard[2]}` + `, ${randomCardTwo[1]} of ${randomCardTwo[2]}`;
    
    let cardImage = new Image();
    cardImage.src = randomCard[3]
    document.querySelector('.cardDisplayImageDealer').appendChild(cardImage);
    
    
    let cardImageTwo = new Image()
    cardImageTwo.src = randomCardTwo[3]
    document.querySelector('.cardDisplayImageDealer').appendChild(cardImageTwo);

    if(dealerCount === 21){
        playerOutCome();
        modalBlackjackWin();
        endGame();
        dealerScore.innerHTML = Number(dealerScore.innerHTML) + 1;
        localStorage.setItem('dealerScore', dealerScore.innerHTML)
    }
}
function cardCount() {
    const getRandomCard = selectRandomWithoutRepetition(allCards);
    let randomCard = getRandomCard()
  
        playerCount += randomCard[0];   
        playerOutput.innerHTML = playerCount;
        cardOutputPlayer.innerHTML += `, ${randomCard[1]} of ${randomCard[2]}`;
        
        playerCount = checkForAce(playerCount, randomCard[1]);
        playerOutput.innerHTML = playerCount;
        

        let cardImage = new Image();
        cardImage.src = randomCard[3]
        document.querySelector('.cardDisplayImagePlayer').appendChild(cardImage);

    if(playerCount === 21){
        playerOutCome(true);
        endGame();
        modalWinColor();
            betAmount = betValue.innerHTML = `Bet: ${Number(chipValueBetNumber.innerHTML) * 2}`;
            bankroll += Number(chipValueBetNumber.innerHTML) * 2;
            bankrollSelector.innerHTML = bankroll 
            localStorage.setItem('bankroll', bankroll);
            playerScore.innerHTML = Number(playerScore.innerHTML) + 1;
            localStorage.setItem('playerScore', playerScore.innerHTML)

    }else if(playerCount > 21) {
        playerOutCome(false);
        endGame();
        dealerScore.innerHTML = Number(dealerScore.innerHTML) +1;
        localStorage.setItem('dealerScore', dealerScore.innerHTML)
    };
}
function standCount() {
    const getRandomCard = selectRandomWithoutRepetition(allCards);
    let randomCard = getRandomCard()
        dealerCount += randomCard[0]; 
        dealerOutput.innerHTML = dealerCount;
        cardOutputDealer.innerHTML += `, ${randomCard[1]} of ${randomCard[2]}`;
        
        dealerCount = checkForAce(dealerCount, randomCard[1]);
        dealerOutput.innerHTML = dealerCount;

        

        let cardImage = new Image();
        cardImage.src = randomCard[3]
        document.querySelector('.cardDisplayImageDealer').appendChild(cardImage);

        if(dealerCount === 21){
            playerOutCome(false);
            endGame();
            dealerScore.innerHTML = Number(dealerScore.innerHTML) +1;
            localStorage.setItem('dealerScore', dealerScore.innerHTML)
        }else if(dealerCount > 21) {
            playerOutCome(true);
            endGame();
            modalWinColor();
            betAmount = betValue.innerHTML = `Bet: ${Number(chipValueBetNumber.innerHTML) * 2}`;
            bankroll += Number(chipValueBetNumber.innerHTML) * 2;
            bankrollSelector.innerHTML = bankroll
            localStorage.setItem('bankroll', bankroll); 
            playerScore.innerHTML = Number(playerScore.innerHTML) + 1;
            localStorage.setItem('playerScore', playerScore.innerHTML)
        };
}
function restartGame(){
    hideButtons();
    location.reload();
    playerCount = 0
    dealerCount = 0
    playerAceCount = 0;
    dealerAceCount = 0;
    allCards = [
        //Hearts
        cardAceHearts, cardTwoHearts, cardThreeHearts, cardFourHearts, cardFiveHearts, cardSixHearts, cardSevenHearts,
        cardEightHearts, cardNineHearts, cardTenHearts, cardJackHearts, cardQueenHearts, cardKingHearts,
        //Diamonds
        cardAceDiamonds, cardTwoDiamonds, cardThreeDiamonds, cardFourDiamonds, cardFiveDiamonds, cardSixDiamonds, cardSevenDiamonds,
        cardEightDiamonds, cardNineDiamonds, cardTenDiamonds, cardJackDiamonds, cardQueenDiamonds, cardKingDiamonds,
        //Clubs
        cardAceClubs, cardTwoClubs, cardThreeClubs, cardFourClubs, cardFiveClubs, cardSixClubs, cardSevenClubs,
        cardEightClubs, cardNineClubs, cardTenClubs, cardJackClubs, cardQueenClubs, cardKingClubs,
        //Spades
        cardAceSpades, cardTwoSpades, cardThreeSpades, cardFourSpades, cardFiveSpades, cardSixSpades, cardSevenSpades,
        cardEightSpades, cardNineSpades, cardTenSpades, cardJackSpades, cardQueenSpades, cardKingSpades
        ];
    dealerOutput.innerHTML = "";
    playerOutput.innerHTML = "";
    playerOutcome.innerHTML = "";
    dealerOutcome.innerHTML = "";
    cardOutputDealer.innerHTML = "";
    cardOutputPlayer.innerHTML = "";
    imageResetDealer.innerHTML = "";
    imageResetPlayer.innerHTML = "";
    hitButton.disabled = false;
    standButton.disabled = false;
    startButton.style.display = "";
    chipDisplaySection.style.display = 'block';
}
function checkForTie(){
    if(dealerCount === 21 && playerCount === 21){
        dealerOutcome.innerHTML = "Tie!";
        playerOutcome.innerHTML = "Tie";
    }else{
        return
    }
}
function endGame() {
    if(dealerCount >= 21 || playerCount >= 21){
        hitButton.disabled = true;
        standButton.disabled = true;
    }else{
        return
    }
}
function checkForAce(totalHand, cardAce) {
    while(totalHand > 21 && cardAce === "Ace" ){
        totalHand -= 10;
    } 
    return totalHand;
}
function playerOutCome(isWin) {
    // Create backdrop element  
    const backdrop = document.createElement('div');
    backdrop.className = 'backdrop';

    // Create modal element
    const modal = document.createElement('div');
    modal.className = 'modal';

    // Check if player wins with isWin, otherwise display "You lose!"
    modal.textContent = isWin ? "You win!" : "You lose!";

    // Set initial styles for fade-in and make elements unclickable
    backdrop.style.opacity = '0';
    modal.style.opacity = '0';
    modal.style.transition = 'opacity 1s ease-in-out'; // Fade-in effect
    backdrop.style.pointerEvents = 'none'; // Disable click events initially

    // Append modal to the backdrop
    backdrop.appendChild(modal);

    // Append the backdrop to the document body
    document.body.appendChild(backdrop);

    // Trigger the fade-in after a very short delay
    setTimeout(() => {
        backdrop.style.transition = 'opacity 1s ease-in-out';
        backdrop.style.opacity = '1';
        modal.style.opacity = '1';
    }, 0); // 0ms delay for near-instant fade-in

    // Enable clicking after the fade-in is done (when opacity reaches 1)
    setTimeout(() => {
        backdrop.style.pointerEvents = 'all'; // Enable click events after fade-in
    }, 1000); // Match this timeout to the fade-in duration (1s)

    // Add a click event to close the modal with fade-out effect
    backdrop.addEventListener('click', () => {
        backdrop.style.opacity = '0';
        modal.style.opacity = '0';

        // Wait for the fade-out transition to finish before removing the element
        setTimeout(() => {
            document.body.removeChild(backdrop);
        }, 1000); // Match this timeout to the duration of the fade-out (1s)
    });
}


function modalWinColor(){
    let modalBackground = document.getElementsByClassName('modal')[0];
    modalBackground.style.backgroundColor = '#28a745';
}
function modalBlackjackWin(){
    let modal = document.getElementsByClassName('modal')[0];
    modal.style.backgroundColor = '#FFD700';
    modal.textContent = "Blackjack!";
    modal.style.color = '#333333';
    modal.style.animation = 'textGrowAndGlow 1s infinite ease-in-out';
}
function selectRandomWithoutRepetition(array) {
    return function () {
        const randomIndex = Math.floor(Math.random() * array.length);
        return array.splice(randomIndex, 1)[0]; // Remove and return the object
    };
}
function hideButtons() {
    hitButton.style.display = 'none';
    standButton.style.display = 'none';
}

function addBankrollStorage() {
    let bankrollStorageAmount = localStorage.getItem('bankroll');
    if (bankrollStorageAmount) {
        bankroll = Number(bankrollStorageAmount); // Use stored value
    } else {
        bankroll = 5000; // Default value for a new game
        localStorage.setItem('bankroll', bankroll); // Store the initial bankroll
    }
    bankrollSelector.innerHTML = bankroll;
}

function addScoreToStorage() {
    let displayPlayerScore = localStorage.getItem('playerScore')
    localStorage.getItem('playerScore')
    playerScore.innerHTML = displayPlayerScore
    let displayDealerScore = localStorage.getItem('dealerScore')
    localStorage.getItem('dealerScore')
    dealerScore.innerHTML = displayDealerScore
}

function resetBankRoll() {
    localStorage.removeItem('bankroll')
    location.reload()
    bankrollSelector.innerHTML = "5000"

}
function checkForName() {
    let nameStorage = localStorage.getItem('playerName');
    
    if (nameStorage) {
        playerName.innerHTML = nameStorage;
        playerNameSecond.innerHTML = nameStorage;
    } else {
        let name = prompt("Please enter your name: (Maximum of 10 characters!)");
        if (name) {
            localStorage.setItem('playerName', name);
            playerName.innerHTML = name;
            playerNameSecond.innerHTML = name;
        } else {
            alert("You didn't enter a name.");
        }
    }
}